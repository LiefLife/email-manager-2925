# 安全性说明

## 密码三层加密机制

为了确保用户密码的安全性，本应用实现了三层加密机制来保护本地存储的密码。

### 第一层：机器特征加密

使用AES-256-GCM算法，密钥通过以下方式派生：
- 获取机器唯一标识符（Machine UID）
- 结合用户邮箱地址
- 使用PBKDF2-HMAC-SHA256进行100,000次迭代
- 生成32字节的加密密钥

特点：
- 密钥与机器硬件绑定
- 即使数据被复制到其他机器，也无法解密
- 使用随机盐值，每次加密结果不同

### 第二层：用户邮箱加密

在第一层加密的基础上，再次使用AES-256-GCM算法：
- 使用用户邮箱地址作为密钥材料
- 使用PBKDF2-HMAC-SHA256进行200,000次迭代
- 生成32字节的加密密钥

特点：
- 双重加密保护
- 密钥与用户身份绑定
- 更高的迭代次数提供更强的安全性

### 第三层：操作系统Keyring存储

将二层加密后的数据存储到操作系统的密钥管理系统：
- Windows: Windows Credential Manager
- macOS: Keychain
- Linux: Secret Service API / libsecret

特点：
- 利用操作系统级别的安全机制
- 需要用户权限才能访问
- 与系统安全策略集成

## 加密流程

```
明文密码
    ↓
[第一层] AES-256-GCM (机器ID + 邮箱)
    ↓
[第二层] AES-256-GCM (邮箱)
    ↓
[第三层] OS Keyring存储
    ↓
安全存储
```

## 解密流程

```
OS Keyring读取
    ↓
[第二层解密] AES-256-GCM (邮箱)
    ↓
[第一层解密] AES-256-GCM (机器ID + 邮箱)
    ↓
明文密码
```

## 安全特性

1. **机器绑定**：密码只能在原机器上解密
2. **用户绑定**：密码与用户邮箱绑定
3. **系统保护**：利用操作系统安全机制
4. **随机盐值**：每次加密使用不同的随机盐
5. **高迭代次数**：PBKDF2使用100,000-200,000次迭代
6. **现代加密算法**：使用AES-256-GCM认证加密

## 向后兼容

为了保证平滑升级，系统同时支持：
- 新的三层加密存储
- 旧的store.json存储（仅作为备用）

当检测到三层加密存储不可用时，会自动回退到旧的存储方式。

## 注意事项

1. 密码仅在启用"自动登录"功能时才会被保存
2. 更换机器后需要重新登录
3. 修改邮箱地址后需要重新登录
4. 建议定期更换密码以提高安全性
